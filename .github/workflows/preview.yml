name: Expo Preview

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  publish-preview:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ— Depoyu Ã‡ek
        uses: actions/checkout@v4

      - name: ðŸ” DosyalarÄ± Listele (Debug)
        run: ls -la

      - name: ðŸ— Node.js Kurulumu
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: ðŸ“¦ EAS CLI YÃ¼kle
        run: npm install -g eas-cli

      - name: ðŸ“¦ BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle
        run: npm install

      # ADIM 1: Ã–nce projeyi Expo ID ile eÅŸleÅŸtiriyoruz (eas.json olmadan)
      - name: ðŸ”— Projeyi EÅŸleÅŸtir (Link)
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        run: eas init --id 7b7866e2-688e-4e87-af97-88213b2670d4 --non-interactive

      # ADIM 2: EÅŸleÅŸme bittikten sonra eas.json dosyasÄ±nÄ± "Update" ayarÄ±yla oluÅŸturuyoruz
      # ( > iÅŸareti var olan dosyanÄ±n Ã¼zerine yazar)
      - name: âš™ï¸ EAS AyarlarÄ±nÄ± YapÄ±landÄ±r
        run: |
          echo '{ "build": { "preview": { "distribution": "internal" } }, "submit": { "production": {} }, "update": { "preview": { "channel": "preview" } } }' > eas.json

      # ADIM 3: GÃ¼ncellemeyi gÃ¶nderiyoruz
      - name: ðŸš€ Expo'ya GÃ¶nder (Update)
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        run: eas update --branch preview --message "GitHub Action Update" --non-interactive
