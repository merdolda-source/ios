name: Expo Preview

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  publish-preview:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ— Depoyu Ã‡ek (Checkout)
        uses: actions/checkout@v4

      - name: ğŸ” DosyalarÄ± Listele (Hata AyÄ±klama)
        run: ls -la # Bu, package.json dosyasÄ±nÄ±n nerede olduÄŸunu loglarda gÃ¶sterir.

      - name: ğŸ— Node.js Kurulumu
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: ğŸ“¦ EAS CLI YÃ¼kle
        run: npm install -g eas-cli

      - name: ğŸ“¦ BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle
        run: npm install

      # EÄŸer eas.json yoksa hata vermemesi iÃ§in biz oluÅŸturuyoruz
      - name: âš™ï¸ EAS AyarlarÄ±nÄ± OluÅŸtur
        run: |
          echo '{ "build": { "preview": { "distribution": "internal" } }, "submit": { "production": {} }, "update": { "preview": { "channel": "preview" } } }' > eas.json

      # Proje ID'sini zorla tanÄ±mlÄ±yoruz (Senin verdiÄŸin ID)
      - name: ğŸ”— Projeyi EÅŸleÅŸtir (Link)
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        run: eas init --id 7b7866e2-688e-4e87-af97-88213b2670d4 --non-interactive

      - name: ğŸš€ Expo'ya GÃ¶nder (Update)
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        run: eas update --branch preview --message "GitHub Action Update" --non-interactive
