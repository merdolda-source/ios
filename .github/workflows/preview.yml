name: Expo Preview

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  publish-preview:
    runs-on: ubuntu-latest

    # working-directory SÄ°LÄ°NDÄ°, ana dizinde Ã§alÄ±ÅŸacak.

    steps:
      - name: ðŸ— Setup Repo
        uses: actions/checkout@v4

      - name: ðŸ” DosyalarÄ± Kontrol Et (Debug)
        run: ls -la # Bu komut hangi dosyalarÄ±n nerede olduÄŸunu loglarda gÃ¶sterecek

      - name: ðŸ— Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: ðŸ“¦ Install EAS CLI
        run: npm install -g eas-cli

      - name: ðŸ“¦ Install Dependencies
        # EÄŸer package.json ana dizindeyse bu Ã§alÄ±ÅŸÄ±r
        run: npm install

      - name: âš™ï¸ Setup EAS Config
        # eas.json dosyasÄ±nÄ± elle oluÅŸturuyoruz
        run: |
          echo '{ "build": { "preview": { "distribution": "internal" } }, "submit": { "production": {} }, "update": { "preview": { "channel": "preview" } } }' > eas.json

      - name: ðŸ”— Link Project
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        # Senin ID'ni buraya tekrar ekledim
        run: eas init --id 7b7866e2-688e-4e87-af97-88213b2670d4 --non-interactive

      - name: ðŸš€ Publish to Expo
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        run: eas update --branch preview --message "Auto update" --non-interactive
