name: Expo Preview

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  publish-preview:
    runs-on: ubuntu-latest
    
    # TÃ¼m iÅŸlemler eminxtream klasÃ¶rÃ¼nde yapÄ±lacak
    defaults:
      run:
        working-directory: ./eminxtream

    steps:
      - name: ðŸ— Setup Repo
        uses: actions/checkout@v4

      - name: ðŸ— Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: ðŸ“¦ Install EAS CLI
        run: npm install -g eas-cli

      - name: ðŸ“¦ Install Dependencies
        run: npm install

      # ðŸ‘‡ YENÄ° EKLENEN ADIM: EAS KonfigÃ¼rasyonu OluÅŸturuluyor
      - name: âš™ï¸ Setup EAS Config
        run: |
          echo '{ "build": { "preview": { "distribution": "internal" } }, "update": { "preview": { "channel": "preview" } } }' > eas.json

      # ðŸ‘‡ YENÄ° EKLENEN ADIM: Proje ID'sini Zorla TanÄ±tÄ±yoruz
      - name: ðŸ”— Link Project
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        run: eas init --id 7b7866e2-688e-4e87-af97-88213b2670d4 --non-interactive

      - name: ðŸš€ Publish to Expo
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        run: eas update --branch preview --message "Auto update" --non-interactive
